<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>旅友WiFi 位置情報PoC</title>
</head>
<body>
  <h1>旅友WiFi 位置情報PoC</h1>
  <p>このサービスはPoC（概念実証）であり、収集されたデータは位置情報分析の目的でのみ使用されます。</p>
  <p>This service is a PoC (Proof of Concept). Collected data will be used solely for location analysis.</p>

  <label for="nationality">国籍 / Nationality:</label>
  <input type="text" id="nationality"><br><br>

  <label for="gender">性別 / Gender:</label>
  <input type="text" id="gender"><br><br>

  <label for="age">年齢 / Age:</label>
  <input type="number" id="age"><br><br>

  <button onclick="sendLocation()">位置情報を送信 / Send Location</button>

  <script>
    let intervalId;

    function sendLocation() {
      const nationality = document.getElementById("nationality").value;
      const gender = document.getElementById("gender").value;
      const age = parseInt(document.getElementById("age").value);

      if (!nationality || !gender || !age) {
        alert("国籍・性別・年齢をすべて入力してください。");
        return;
      }

      navigator.geolocation.getCurrentPosition(async function(position) {
        const latitude = position.coords.latitude;
        const longitude = position.coords.longitude;

        const now = new Date();
        const jst = new Date(now.getTime() + 9 * 60 * 60 * 1000); // JSTに変換
        const timestamp = jst.toISOString();

        await fetch("https://tabitomo-server.onrender.com/location", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            latitude,
            longitude,
            timestamp,
            nationality,
            gender,
            age
          })
        });

        alert("位置情報送信完了！");
      }, function(error) {
        alert("位置情報の取得に失敗しました: " + error.message);
      });

      // 自動送信（5分間隔）
      if (!intervalId) {
        intervalId = setInterval(() => {
          sendLocation();
        }, 5 * 60 * 1000); // 5分
        // 1時間で止める
        setTimeout(() => {
          clearInterval(intervalId);
          intervalId = null;
        }, 60 * 60 * 1000); // 1時間
      }
    }
  </script>
</body>
</html>
