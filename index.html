<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>旅友WiFi 位置情報PoC</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2em;
    }
    input, select, button {
      margin: 0.5em 0;
      display: block;
    }
  </style>
</head>
<body>
  <h1>旅友WiFi 位置情報PoC / Location Tracking PoC</h1>
  <p>
    ※本サービスはPoC（実証実験）として実施されており、位置情報・属性情報はSupabaseに記録されます。
    <br>
    This is a proof of concept (PoC). Your location and demographic data will be stored on Supabase.
  </p>

  <label>国籍 / Nationality: <input type="text" id="nationality" /></label>
  <label>性別 / Gender:
    <select id="gender">
      <option value="">選択してください / Please select</option>
      <option value="Male">男性 / Male</option>
      <option value="Female">女性 / Female</option>
      <option value="Other">その他 / Other</option>
    </select>
  </label>
  <label>年齢 / Age: <input type="number" id="age" min="0" /></label>

  <button onclick="sendLocation()">位置情報を送信 / Send Location</button>

  <h2>利用規約 / Terms of Use</h2>
  <p>
    このサービスは実証実験用であり、提供する情報はすべて匿名で扱われます。取得した情報は今後のサービス改善目的でのみ使用されます。
    <br>
    This service is for experimental purposes only. All data is treated anonymously and used solely for improvement purposes.
  </p>

  <script>
    const SUPABASE_URL = "https://tabitomo-server.onrender.com/location";

    function getLocalTimestamp() {
      const now = new Date();
      now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
      return now.toISOString().replace('T', ' ').slice(0, 19);
    }

    function sendLocation() {
      navigator.geolocation.getCurrentPosition(function (position) {
        const data = {
          latitude: position.coords.latitude,
          longitude: position.coords.longitude,
          timestamp: getLocalTimestamp(),
          nationality: document.getElementById("nationality").value,
          gender: document.getElementById("gender").value,
          age: parseInt(document.getElementById("age").value, 10) || null
        };

        fetch(SUPABASE_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        })
        .then(() => alert("位置情報送信完了！ / Location sent!"))
        .catch(() => alert("送信に失敗しました / Failed to send location"));
      });
    }

    setInterval(sendLocation, 5 * 60 * 1000); // 5分ごと自動送信
  </script>
</body>
</html>
