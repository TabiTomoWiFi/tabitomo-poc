<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>旅友WiFi 位置情報PoC</title>
</head>
<body>
  <h1>旅友WiFi | 位置情報PoC</h1>
  <p>※このサービスはPoC（概念実証）です。ご利用には同意が必要です。</p>
  <p>This is a Proof of Concept (PoC) for location tracking using TabitomoWiFi.</p>

  <p><a href="terms.html" target="_blank">利用規約 / Terms of Use</a></p>

  <form id="userForm">
    <label>国籍 / Nationality:
      <input type="text" id="nationality" required />
    </label><br/>
    <label>性別 / Gender:
      <input type="text" id="gender" required />
    </label><br/>
    <label>年齢 / Age:
      <input type="number" id="age" required />
    </label><br/>
    <button type="submit">位置情報を送信 / Send Location</button>
  </form>

  <script>
    function getJapanTimeISOString() {
      const now = new Date();
      const jst = new Date(now.getTime() + 9 * 60 * 60 * 1000);
      return jst.toISOString();
    }

    async function sendLocation() {
      navigator.geolocation.getCurrentPosition(async (position) => {
        const latitude = position.coords.latitude;
        const longitude = position.coords.longitude;
        const timestamp = getJapanTimeISOString();

        const nationality = document.getElementById("nationality").value;
        const gender = document.getElementById("gender").value;
        const age = parseInt(document.getElementById("age").value, 10);

        const res = await fetch("https://tabitomo-server.onrender.com/location", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ latitude, longitude, timestamp, nationality, gender, age }),
        });

        if (res.ok) {
          alert("位置情報送信完了！");
        } else {
          alert("送信に失敗しました");
        }
      }, () => {
        alert("位置情報の取得に失敗しました。");
      });
    }

    document.getElementById("userForm").addEventListener("submit", (e) => {
      e.preventDefault();
      sendLocation();
    });

    // 自動送信（5分ごと）
    setInterval(sendLocation, 5 * 60 * 1000);
  </script>
</body>
</html>
