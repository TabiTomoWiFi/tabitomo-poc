<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>旅友WiFi - PoC</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    label, select, input { margin-bottom: 10px; display: block; }
  </style>
</head>
<body>
  <h1>旅友WiFi（PoC）</h1>
  <p>※このサービスは実証実験（PoC）です。位置情報を5分ごとに取得・送信します。</p>
  <p>This is a Proof of Concept (PoC) service. Your location will be sent every 5 minutes.</p>

  <label>国籍 / Nationality:
    <input type="text" id="nationality">
  </label>
  <label>性別 / Gender:
    <select id="gender">
      <option value="male">男性 / Male</option>
      <option value="female">女性 / Female</option>
      <option value="other">その他 / Other</option>
    </select>
  </label>
  <label>年齢 / Age:
    <input type="number" id="age">
  </label>

  <p>
    <strong>利用規約 / Terms of Use:</strong><br>
    このサービスは位置情報を収集します。実験目的で使用され、商用利用されません。<br>
    This service collects location data. It is used for experimental purposes only and not for commercial use.
  </p>

  <button onclick="startTracking()">位置情報の送信を開始 / Start Tracking</button>

  <div id="status"></div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

    const supabaseUrl = 'https://qofqcxiykikhsatgvraj.supabase.co/'; // ←あなたのURLに変更
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFvZnFjeGl5a2lraHNhdGd2cmFqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDYwMTI1NTgsImV4cCI6MjA2MTU4ODU1OH0._sBqBozyhHh5esrblqFZXCpXo8RLJYfam0txAH40b2c'; // ←あなたのキーに変更
    const supabase = createClient(supabaseUrl, supabaseKey);

    let intervalId = null;

    async function sendLocation() {
      navigator.geolocation.getCurrentPosition(async (position) => {
        const { latitude, longitude } = position.coords;
        const nationality = document.getElementById('nationality').value;
        const gender = document.getElementById('gender').value;
        const age = parseInt(document.getElementById('age').value);

        const { error } = await supabase.from('location').insert([{
          timestamp: new Date().toISOString(),
          latitude,
          longitude,
          nationality,
          gender,
          age
        }]);

        const status = document.getElementById('status');
        if (error) {
          console.error('送信エラー:', error);
          status.textContent = '送信に失敗しました';
        } else {
          status.textContent = `送信しました: ${new Date().toLocaleTimeString()}`;
        }
      });
    }

    window.startTracking = function () {
      if (intervalId) return;
      sendLocation();
      intervalId = setInterval(sendLocation, 5 * 60 * 1000); // 5分ごと
      document.getElementById('status').textContent = '送信を開始しました';
    }
  </script>
</body>
</html>
